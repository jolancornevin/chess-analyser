{"ast":null,"code":"import { key2pos } from './util.js';\nimport { syncShapes } from './sync.js';\nexport function createElement(tagName) {\n  return document.createElementNS('http://www.w3.org/2000/svg', tagName);\n}\nexport function renderSvg(state, svg, customSvg) {\n  const d = state.drawable,\n    curD = d.current,\n    cur = curD && curD.mouseSq ? curD : undefined,\n    arrowDests = new Map(),\n    bounds = state.dom.bounds(),\n    nonPieceAutoShapes = d.autoShapes.filter(autoShape => !autoShape.piece);\n  for (const s of d.shapes.concat(nonPieceAutoShapes).concat(cur ? [cur] : [])) {\n    if (s.dest) arrowDests.set(s.dest, (arrowDests.get(s.dest) || 0) + 1);\n  }\n  const shapes = d.shapes.concat(nonPieceAutoShapes).map(s => {\n    return {\n      shape: s,\n      current: false,\n      hash: shapeHash(s, arrowDests, false, bounds)\n    };\n  });\n  if (cur) shapes.push({\n    shape: cur,\n    current: true,\n    hash: shapeHash(cur, arrowDests, true, bounds)\n  });\n  const fullHash = shapes.map(sc => sc.hash).join(';');\n  if (fullHash === state.drawable.prevSvgHash) return;\n  state.drawable.prevSvgHash = fullHash;\n  /*\n    -- DOM hierarchy --\n    <svg class=\"cg-shapes\">      (<= svg)\n      <defs>\n        ...(for brushes)...\n      </defs>\n      <g>\n        ...(for arrows and circles)...\n      </g>\n    </svg>\n    <svg class=\"cg-custom-svgs\"> (<= customSvg)\n      <g>\n        ...(for custom svgs)...\n      </g>\n    </svg>\n  */\n  const defsEl = svg.querySelector('defs');\n  const shapesEl = svg.querySelector('g');\n  const customSvgsEl = customSvg.querySelector('g');\n  syncDefs(d, shapes, defsEl);\n  syncShapes(shapes.filter(s => !s.shape.customSvg), shapesEl, shape => renderShape(state, shape, d.brushes, arrowDests, bounds));\n  syncShapes(shapes.filter(s => s.shape.customSvg), customSvgsEl, shape => renderShape(state, shape, d.brushes, arrowDests, bounds));\n}\n// append only. Don't try to update/remove.\nfunction syncDefs(d, shapes, defsEl) {\n  const brushes = new Map();\n  let brush;\n  for (const s of shapes) {\n    if (s.shape.dest) {\n      brush = d.brushes[s.shape.brush];\n      if (s.shape.modifiers) brush = makeCustomBrush(brush, s.shape.modifiers);\n      brushes.set(brush.key, brush);\n    }\n  }\n  const keysInDom = new Set();\n  let el = defsEl.firstChild;\n  while (el) {\n    keysInDom.add(el.getAttribute('cgKey'));\n    el = el.nextSibling;\n  }\n  for (const [key, brush] of brushes.entries()) {\n    if (!keysInDom.has(key)) defsEl.appendChild(renderMarker(brush));\n  }\n}\nfunction shapeHash({\n  orig,\n  dest,\n  brush,\n  piece,\n  modifiers,\n  customSvg\n}, arrowDests, current, bounds) {\n  return [bounds.width, bounds.height, current, orig, dest, brush, dest && (arrowDests.get(dest) || 0) > 1, piece && pieceHash(piece), modifiers && modifiersHash(modifiers), customSvg && customSvgHash(customSvg)].filter(x => x).join(',');\n}\nfunction pieceHash(piece) {\n  return [piece.color, piece.role, piece.scale].filter(x => x).join(',');\n}\nfunction modifiersHash(m) {\n  return '' + (m.lineWidth || '');\n}\nfunction customSvgHash(s) {\n  // Rolling hash with base 31 (cf. https://stackoverflow.com/questions/7616461/generate-a-hash-from-string-in-javascript)\n  let h = 0;\n  for (let i = 0; i < s.length; i++) {\n    h = (h << 5) - h + s.charCodeAt(i) >>> 0;\n  }\n  return 'custom-' + h.toString();\n}\nfunction renderShape(state, {\n  shape,\n  current,\n  hash\n}, brushes, arrowDests, bounds) {\n  let el;\n  const orig = orient(key2pos(shape.orig), state.orientation);\n  if (shape.customSvg) {\n    el = renderCustomSvg(shape.customSvg, orig, bounds);\n  } else {\n    if (shape.dest) {\n      let brush = brushes[shape.brush];\n      if (shape.modifiers) brush = makeCustomBrush(brush, shape.modifiers);\n      el = renderArrow(brush, orig, orient(key2pos(shape.dest), state.orientation), current, (arrowDests.get(shape.dest) || 0) > 1, bounds);\n    } else el = renderCircle(brushes[shape.brush], orig, current, bounds);\n  }\n  el.setAttribute('cgHash', hash);\n  return el;\n}\nfunction renderCustomSvg(customSvg, pos, bounds) {\n  const [x, y] = pos2user(pos, bounds);\n  // Translate to top-left of `orig` square\n  const g = setAttributes(createElement('g'), {\n    transform: `translate(${x},${y})`\n  });\n  // Give 100x100 coordinate system to the user for `orig` square\n  const svg = setAttributes(createElement('svg'), {\n    width: 1,\n    height: 1,\n    viewBox: '0 0 100 100'\n  });\n  g.appendChild(svg);\n  svg.innerHTML = customSvg;\n  return g;\n}\nfunction renderCircle(brush, pos, current, bounds) {\n  const o = pos2user(pos, bounds),\n    widths = circleWidth(),\n    radius = (bounds.width + bounds.height) / (4 * Math.max(bounds.width, bounds.height));\n  return setAttributes(createElement('circle'), {\n    stroke: brush.color,\n    'stroke-width': widths[current ? 0 : 1],\n    fill: 'none',\n    opacity: opacity(brush, current),\n    cx: o[0],\n    cy: o[1],\n    r: radius - widths[1] / 2\n  });\n}\nfunction renderArrow(brush, orig, dest, current, shorten, bounds) {\n  const m = arrowMargin(shorten && !current),\n    a = pos2user(orig, bounds),\n    b = pos2user(dest, bounds),\n    dx = b[0] - a[0],\n    dy = b[1] - a[1],\n    angle = Math.atan2(dy, dx),\n    xo = Math.cos(angle) * m,\n    yo = Math.sin(angle) * m;\n  return setAttributes(createElement('line'), {\n    stroke: brush.color,\n    'stroke-width': lineWidth(brush, current),\n    'stroke-linecap': 'round',\n    'marker-end': 'url(#arrowhead-' + brush.key + ')',\n    opacity: opacity(brush, current),\n    x1: a[0],\n    y1: a[1],\n    x2: b[0] - xo,\n    y2: b[1] - yo\n  });\n}\nfunction renderMarker(brush) {\n  const marker = setAttributes(createElement('marker'), {\n    id: 'arrowhead-' + brush.key,\n    orient: 'auto',\n    markerWidth: 4,\n    markerHeight: 8,\n    refX: 2.05,\n    refY: 2.01\n  });\n  marker.appendChild(setAttributes(createElement('path'), {\n    d: 'M0,0 V4 L3,2 Z',\n    fill: brush.color\n  }));\n  marker.setAttribute('cgKey', brush.key);\n  return marker;\n}\nexport function setAttributes(el, attrs) {\n  for (const key in attrs) {\n    if (Object.prototype.hasOwnProperty.call(attrs, key)) el.setAttribute(key, attrs[key]);\n  }\n  return el;\n}\nfunction orient(pos, color) {\n  return color === 'white' ? pos : [7 - pos[0], 7 - pos[1]];\n}\nfunction makeCustomBrush(base, modifiers) {\n  return {\n    color: base.color,\n    opacity: Math.round(base.opacity * 10) / 10,\n    lineWidth: Math.round(modifiers.lineWidth || base.lineWidth),\n    key: [base.key, modifiers.lineWidth].filter(x => x).join('')\n  };\n}\nfunction circleWidth() {\n  return [3 / 64, 4 / 64];\n}\nfunction lineWidth(brush, current) {\n  return (brush.lineWidth || 10) * (current ? 0.85 : 1) / 64;\n}\nfunction opacity(brush, current) {\n  return (brush.opacity || 1) * (current ? 0.9 : 1);\n}\nfunction arrowMargin(shorten) {\n  return (shorten ? 20 : 10) / 64;\n}\nfunction pos2user(pos, bounds) {\n  const xScale = Math.min(1, bounds.width / bounds.height);\n  const yScale = Math.min(1, bounds.height / bounds.width);\n  return [(pos[0] - 3.5) * xScale, (3.5 - pos[1]) * yScale];\n}","map":{"version":3,"names":["key2pos","syncShapes","createElement","tagName","document","createElementNS","renderSvg","state","svg","customSvg","d","drawable","curD","current","cur","mouseSq","undefined","arrowDests","Map","bounds","dom","nonPieceAutoShapes","autoShapes","filter","autoShape","piece","s","shapes","concat","dest","set","get","map","shape","hash","shapeHash","push","fullHash","sc","join","prevSvgHash","defsEl","querySelector","shapesEl","customSvgsEl","syncDefs","renderShape","brushes","brush","modifiers","makeCustomBrush","key","keysInDom","Set","el","firstChild","add","getAttribute","nextSibling","entries","has","appendChild","renderMarker","orig","width","height","pieceHash","modifiersHash","customSvgHash","x","color","role","scale","m","lineWidth","h","i","length","charCodeAt","toString","orient","orientation","renderCustomSvg","renderArrow","renderCircle","setAttribute","pos","y","pos2user","g","setAttributes","transform","viewBox","innerHTML","o","widths","circleWidth","radius","Math","max","stroke","fill","opacity","cx","cy","r","shorten","arrowMargin","a","b","dx","dy","angle","atan2","xo","cos","yo","sin","x1","y1","x2","y2","marker","id","markerWidth","markerHeight","refX","refY","attrs","Object","prototype","hasOwnProperty","call","base","round","xScale","min","yScale"],"sources":["/Users/jcornevin/Dev/Perso/chess-analyser/node_modules/chessground/src/svg.ts"],"sourcesContent":["import { State } from './state.js';\nimport { key2pos } from './util.js';\nimport { Drawable, DrawShape, DrawShapePiece, DrawBrush, DrawBrushes, DrawModifiers } from './draw.js';\nimport { SyncableShape, Hash, syncShapes } from './sync.js';\nimport * as cg from './types.js';\n\nexport function createElement(tagName: string): SVGElement {\n  return document.createElementNS('http://www.w3.org/2000/svg', tagName);\n}\n\ntype CustomBrushes = Map<string, DrawBrush>; // by hash\n\ntype ArrowDests = Map<cg.Key, number>; // how many arrows land on a square\n\nexport function renderSvg(state: State, svg: SVGElement, customSvg: SVGElement): void {\n  const d = state.drawable,\n    curD = d.current,\n    cur = curD && curD.mouseSq ? (curD as DrawShape) : undefined,\n    arrowDests: ArrowDests = new Map(),\n    bounds = state.dom.bounds(),\n    nonPieceAutoShapes = d.autoShapes.filter(autoShape => !autoShape.piece);\n\n  for (const s of d.shapes.concat(nonPieceAutoShapes).concat(cur ? [cur] : [])) {\n    if (s.dest) arrowDests.set(s.dest, (arrowDests.get(s.dest) || 0) + 1);\n  }\n\n  const shapes: SyncableShape[] = d.shapes.concat(nonPieceAutoShapes).map((s: DrawShape) => {\n    return {\n      shape: s,\n      current: false,\n      hash: shapeHash(s, arrowDests, false, bounds),\n    };\n  });\n  if (cur)\n    shapes.push({\n      shape: cur,\n      current: true,\n      hash: shapeHash(cur, arrowDests, true, bounds),\n    });\n\n  const fullHash = shapes.map(sc => sc.hash).join(';');\n  if (fullHash === state.drawable.prevSvgHash) return;\n  state.drawable.prevSvgHash = fullHash;\n\n  /*\n    -- DOM hierarchy --\n    <svg class=\"cg-shapes\">      (<= svg)\n      <defs>\n        ...(for brushes)...\n      </defs>\n      <g>\n        ...(for arrows and circles)...\n      </g>\n    </svg>\n    <svg class=\"cg-custom-svgs\"> (<= customSvg)\n      <g>\n        ...(for custom svgs)...\n      </g>\n    </svg>\n  */\n\n  const defsEl = svg.querySelector('defs') as SVGElement;\n  const shapesEl = svg.querySelector('g') as SVGElement;\n  const customSvgsEl = customSvg.querySelector('g') as SVGElement;\n\n  syncDefs(d, shapes, defsEl);\n  syncShapes(\n    shapes.filter(s => !s.shape.customSvg),\n    shapesEl,\n    shape => renderShape(state, shape, d.brushes, arrowDests, bounds)\n  );\n  syncShapes(\n    shapes.filter(s => s.shape.customSvg),\n    customSvgsEl,\n    shape => renderShape(state, shape, d.brushes, arrowDests, bounds)\n  );\n}\n\n// append only. Don't try to update/remove.\nfunction syncDefs(d: Drawable, shapes: SyncableShape[], defsEl: SVGElement) {\n  const brushes: CustomBrushes = new Map();\n  let brush: DrawBrush;\n  for (const s of shapes) {\n    if (s.shape.dest) {\n      brush = d.brushes[s.shape.brush!];\n      if (s.shape.modifiers) brush = makeCustomBrush(brush, s.shape.modifiers);\n      brushes.set(brush.key, brush);\n    }\n  }\n  const keysInDom = new Set();\n  let el: SVGElement | undefined = defsEl.firstChild as SVGElement;\n  while (el) {\n    keysInDom.add(el.getAttribute('cgKey'));\n    el = el.nextSibling as SVGElement | undefined;\n  }\n  for (const [key, brush] of brushes.entries()) {\n    if (!keysInDom.has(key)) defsEl.appendChild(renderMarker(brush));\n  }\n}\n\nfunction shapeHash(\n  { orig, dest, brush, piece, modifiers, customSvg }: DrawShape,\n  arrowDests: ArrowDests,\n  current: boolean,\n  bounds: ClientRect\n): Hash {\n  return [\n    bounds.width,\n    bounds.height,\n    current,\n    orig,\n    dest,\n    brush,\n    dest && (arrowDests.get(dest) || 0) > 1,\n    piece && pieceHash(piece),\n    modifiers && modifiersHash(modifiers),\n    customSvg && customSvgHash(customSvg),\n  ]\n    .filter(x => x)\n    .join(',');\n}\n\nfunction pieceHash(piece: DrawShapePiece): Hash {\n  return [piece.color, piece.role, piece.scale].filter(x => x).join(',');\n}\n\nfunction modifiersHash(m: DrawModifiers): Hash {\n  return '' + (m.lineWidth || '');\n}\n\nfunction customSvgHash(s: string): Hash {\n  // Rolling hash with base 31 (cf. https://stackoverflow.com/questions/7616461/generate-a-hash-from-string-in-javascript)\n  let h = 0;\n  for (let i = 0; i < s.length; i++) {\n    h = ((h << 5) - h + s.charCodeAt(i)) >>> 0;\n  }\n  return 'custom-' + h.toString();\n}\n\nfunction renderShape(\n  state: State,\n  { shape, current, hash }: SyncableShape,\n  brushes: DrawBrushes,\n  arrowDests: ArrowDests,\n  bounds: ClientRect\n): SVGElement {\n  let el: SVGElement;\n  const orig = orient(key2pos(shape.orig), state.orientation);\n\n  if (shape.customSvg) {\n    el = renderCustomSvg(shape.customSvg, orig, bounds);\n  } else {\n    if (shape.dest) {\n      let brush: DrawBrush = brushes[shape.brush!];\n      if (shape.modifiers) brush = makeCustomBrush(brush, shape.modifiers);\n      el = renderArrow(\n        brush,\n        orig,\n        orient(key2pos(shape.dest), state.orientation),\n        current,\n        (arrowDests.get(shape.dest) || 0) > 1,\n        bounds\n      );\n    } else el = renderCircle(brushes[shape.brush!], orig, current, bounds);\n  }\n  el.setAttribute('cgHash', hash);\n  return el;\n}\n\nfunction renderCustomSvg(customSvg: string, pos: cg.Pos, bounds: ClientRect): SVGElement {\n  const [x, y] = pos2user(pos, bounds);\n\n  // Translate to top-left of `orig` square\n  const g = setAttributes(createElement('g'), { transform: `translate(${x},${y})` });\n\n  // Give 100x100 coordinate system to the user for `orig` square\n  const svg = setAttributes(createElement('svg'), { width: 1, height: 1, viewBox: '0 0 100 100' });\n\n  g.appendChild(svg);\n  svg.innerHTML = customSvg;\n  return g;\n}\n\nfunction renderCircle(brush: DrawBrush, pos: cg.Pos, current: boolean, bounds: ClientRect): SVGElement {\n  const o = pos2user(pos, bounds),\n    widths = circleWidth(),\n    radius = (bounds.width + bounds.height) / (4 * Math.max(bounds.width, bounds.height));\n  return setAttributes(createElement('circle'), {\n    stroke: brush.color,\n    'stroke-width': widths[current ? 0 : 1],\n    fill: 'none',\n    opacity: opacity(brush, current),\n    cx: o[0],\n    cy: o[1],\n    r: radius - widths[1] / 2,\n  });\n}\n\nfunction renderArrow(\n  brush: DrawBrush,\n  orig: cg.Pos,\n  dest: cg.Pos,\n  current: boolean,\n  shorten: boolean,\n  bounds: ClientRect\n): SVGElement {\n  const m = arrowMargin(shorten && !current),\n    a = pos2user(orig, bounds),\n    b = pos2user(dest, bounds),\n    dx = b[0] - a[0],\n    dy = b[1] - a[1],\n    angle = Math.atan2(dy, dx),\n    xo = Math.cos(angle) * m,\n    yo = Math.sin(angle) * m;\n  return setAttributes(createElement('line'), {\n    stroke: brush.color,\n    'stroke-width': lineWidth(brush, current),\n    'stroke-linecap': 'round',\n    'marker-end': 'url(#arrowhead-' + brush.key + ')',\n    opacity: opacity(brush, current),\n    x1: a[0],\n    y1: a[1],\n    x2: b[0] - xo,\n    y2: b[1] - yo,\n  });\n}\n\nfunction renderMarker(brush: DrawBrush): SVGElement {\n  const marker = setAttributes(createElement('marker'), {\n    id: 'arrowhead-' + brush.key,\n    orient: 'auto',\n    markerWidth: 4,\n    markerHeight: 8,\n    refX: 2.05,\n    refY: 2.01,\n  });\n  marker.appendChild(\n    setAttributes(createElement('path'), {\n      d: 'M0,0 V4 L3,2 Z',\n      fill: brush.color,\n    })\n  );\n  marker.setAttribute('cgKey', brush.key);\n  return marker;\n}\n\nexport function setAttributes(el: SVGElement, attrs: { [key: string]: any }): SVGElement {\n  for (const key in attrs) {\n    if (Object.prototype.hasOwnProperty.call(attrs, key)) el.setAttribute(key, attrs[key]);\n  }\n  return el;\n}\n\nfunction orient(pos: cg.Pos, color: cg.Color): cg.Pos {\n  return color === 'white' ? pos : [7 - pos[0], 7 - pos[1]];\n}\n\nfunction makeCustomBrush(base: DrawBrush, modifiers: DrawModifiers): DrawBrush {\n  return {\n    color: base.color,\n    opacity: Math.round(base.opacity * 10) / 10,\n    lineWidth: Math.round(modifiers.lineWidth || base.lineWidth),\n    key: [base.key, modifiers.lineWidth].filter(x => x).join(''),\n  };\n}\n\nfunction circleWidth(): [number, number] {\n  return [3 / 64, 4 / 64];\n}\n\nfunction lineWidth(brush: DrawBrush, current: boolean): number {\n  return ((brush.lineWidth || 10) * (current ? 0.85 : 1)) / 64;\n}\n\nfunction opacity(brush: DrawBrush, current: boolean): number {\n  return (brush.opacity || 1) * (current ? 0.9 : 1);\n}\n\nfunction arrowMargin(shorten: boolean): number {\n  return (shorten ? 20 : 10) / 64;\n}\n\nfunction pos2user(pos: cg.Pos, bounds: ClientRect): cg.NumberPair {\n  const xScale = Math.min(1, bounds.width / bounds.height);\n  const yScale = Math.min(1, bounds.height / bounds.width);\n  return [(pos[0] - 3.5) * xScale, (3.5 - pos[1]) * yScale];\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}